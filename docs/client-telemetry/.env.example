# ============================================================================
# CLIENT TELEMETRY ENVIRONMENT VARIABLES
# ============================================================================
# Copy this file to apps/demo-web/.env.local and configure as needed

# ============================================================================
# CLIENT-SIDE CONFIGURATION (NEXT_PUBLIC_ prefix required)
# ============================================================================

# Telemetry endpoint
# Default: /api/client-telemetry (same Next.js server)
# Production: Point to dedicated telemetry service
# Example: https://telemetry.yourdomain.com/telemetry
NEXT_PUBLIC_CLIENT_TELEMETRY_ENDPOINT=/api/client-telemetry

# Maximum events to batch before auto-flush
# Default: 20
# Higher = fewer HTTP requests but more delay
# Lower = more HTTP requests but less delay
NEXT_PUBLIC_CLIENT_TELEMETRY_BATCH_SIZE=20

# Flush interval in milliseconds
# Default: 2000 (2 seconds)
# Higher = fewer HTTP requests but more delay
# Lower = more HTTP requests but less delay
NEXT_PUBLIC_CLIENT_TELEMETRY_FLUSH_INTERVAL_MS=2000

# ============================================================================
# SERVER-SIDE CONFIGURATION
# ============================================================================

# OpenTelemetry Collector endpoint (optional)
# When set, events are forwarded to OTEL collector in OTLP/JSON format
# Default: not set (no forwarding)
# Local development: http://localhost:4318/v1/logs
# Production: http://otel-collector:4318/v1/logs
OTEL_COLLECTOR_ENDPOINT=http://localhost:4318/v1/logs

# OTEL collector request timeout in milliseconds
# Default: 5000 (5 seconds)
# Increase if collector is slow or remote
OTEL_COLLECTOR_TIMEOUT_MS=5000

# Rate limiting: window size in milliseconds
# Default: 60000 (1 minute)
# This is the time window for counting requests
CLIENT_TELEMETRY_RATE_LIMIT_WINDOW_MS=60000

# Rate limiting: maximum requests per window per IP
# Default: 100
# Development: 1000+ (to avoid hitting limits during testing)
# Production: 100-500 (based on expected load per client)
CLIENT_TELEMETRY_RATE_LIMIT_MAX_REQUESTS=100

# ============================================================================
# CONFIGURATION EXAMPLES
# ============================================================================

# --- Example 1: Development (Local OTEL Collector) ---
# NEXT_PUBLIC_CLIENT_TELEMETRY_ENDPOINT=/api/client-telemetry
# NEXT_PUBLIC_CLIENT_TELEMETRY_BATCH_SIZE=20
# NEXT_PUBLIC_CLIENT_TELEMETRY_FLUSH_INTERVAL_MS=2000
# OTEL_COLLECTOR_ENDPOINT=http://localhost:4318/v1/logs
# OTEL_COLLECTOR_TIMEOUT_MS=5000
# CLIENT_TELEMETRY_RATE_LIMIT_MAX_REQUESTS=1000

# --- Example 2: Production (Separate Telemetry Service) ---
# NEXT_PUBLIC_CLIENT_TELEMETRY_ENDPOINT=https://telemetry.yourdomain.com/telemetry
# NEXT_PUBLIC_CLIENT_TELEMETRY_BATCH_SIZE=50
# NEXT_PUBLIC_CLIENT_TELEMETRY_FLUSH_INTERVAL_MS=5000
# OTEL_COLLECTOR_ENDPOINT=http://otel-collector:4318/v1/logs
# OTEL_COLLECTOR_TIMEOUT_MS=3000
# CLIENT_TELEMETRY_RATE_LIMIT_MAX_REQUESTS=500

# --- Example 3: No OTEL Collector (Pino logs only) ---
# NEXT_PUBLIC_CLIENT_TELEMETRY_ENDPOINT=/api/client-telemetry
# NEXT_PUBLIC_CLIENT_TELEMETRY_BATCH_SIZE=20
# NEXT_PUBLIC_CLIENT_TELEMETRY_FLUSH_INTERVAL_MS=2000
# # OTEL_COLLECTOR_ENDPOINT not set
# CLIENT_TELEMETRY_RATE_LIMIT_MAX_REQUESTS=100

# --- Example 4: High-Traffic Production ---
# NEXT_PUBLIC_CLIENT_TELEMETRY_ENDPOINT=https://telemetry.yourdomain.com/telemetry
# NEXT_PUBLIC_CLIENT_TELEMETRY_BATCH_SIZE=100
# NEXT_PUBLIC_CLIENT_TELEMETRY_FLUSH_INTERVAL_MS=10000
# OTEL_COLLECTOR_ENDPOINT=http://otel-collector:4318/v1/logs
# OTEL_COLLECTOR_TIMEOUT_MS=2000
# CLIENT_TELEMETRY_RATE_LIMIT_MAX_REQUESTS=1000

# ============================================================================
# NOTES
# ============================================================================

# 1. Client-side env vars (NEXT_PUBLIC_*) are embedded in the client bundle
#    - They are visible in browser DevTools
#    - Never put secrets in NEXT_PUBLIC_ variables
#    - Restart Next.js dev server after changing

# 2. Server-side env vars are only available on the server
#    - Safe for secrets (API keys, endpoints)
#    - Not accessible from browser

# 3. Batching trade-offs:
#    - Larger batch size = fewer requests = lower network overhead
#    - Smaller batch size = more real-time but more requests
#    - Balance based on your needs

# 4. Rate limiting in production:
#    - Use Redis for distributed rate limiting across instances
#    - Monitor rate limit violations with alerts
#    - Adjust limits based on actual traffic patterns

# 5. OTEL Collector:
#    - Optional but recommended for production
#    - Enables centralized logging, metrics, and tracing
#    - Configure exporters in otel-collector-config.yaml
